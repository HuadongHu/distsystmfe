
<!DOCTYPE HTML>
<html lang="zh-hans" >
    <head>
        <meta charset="UTF-8">
        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <title>2. Lamport图; happens-before; 网络模型; 状态与事件; 偏序(partial orders) · 分布式系统</title>
        <meta http-equiv="X-UA-Compatible" content="IE=edge" />
        <meta name="description" content="">
        <meta name="generator" content="GitBook 3.2.3">
        <meta name="author" content="Huadong Hu">
        
        
    
    <link rel="stylesheet" href="gitbook/style.css">

    
            
                
                <link rel="stylesheet" href="gitbook/gitbook-plugin-disqus/plugin.css">
                
            
                
                <link rel="stylesheet" href="gitbook/gitbook-plugin-highlight/website.css">
                
            
                
                <link rel="stylesheet" href="gitbook/gitbook-plugin-search/search.css">
                
            
                
                <link rel="stylesheet" href="gitbook/gitbook-plugin-fontsettings/website.css">
                
            
        

    

    
        
    
        
    
        
    
        
    
        
    
        
    

        
    
    
    <meta name="HandheldFriendly" content="true"/>
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <link rel="apple-touch-icon-precomposed" sizes="152x152" href="gitbook/images/apple-touch-icon-precomposed-152.png">
    <link rel="shortcut icon" href="gitbook/images/favicon.ico" type="image/x-icon">

    
    <link rel="next" href="2.-lamport-diagramshappensbefore-tong-bu-wang-luo-yu-yi-bu-wang-luo-pian-xu-guan-xi.html" />
    
    
    <link rel="prev" href="distributed-systems-what-and-why-time-and-clocks.html" />
    

    </head>
    <body>
        
<div class="book">
    <div class="book-summary">
        
            
<div id="book-search-input" role="search">
    <input type="text" placeholder="输入并搜索" />
</div>

            
                <nav role="navigation">
                


<ul class="summary">
    
    

    

    
        
        
    
        <li class="chapter " data-level="1.1" data-path="./">
            
                <a href="./">
            
                    
                    📚分布式系统(Distributed Systems)
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2" data-path="distributed-systems-what-and-why-time-and-clocks.html">
            
                <a href="distributed-systems-what-and-why-time-and-clocks.html">
            
                    
                    1. 什么是和为什么分布式系统？时间和时钟。
            
                </a>
            

            
        </li>
    
        <li class="chapter active" data-level="1.3" data-path="2.-lamport-tu-happensbefore-wang-luo-mo-xing-zhuang-tai-yu-shi-jian-pian-xu-partial-orders.html">
            
                <a href="2.-lamport-tu-happensbefore-wang-luo-mo-xing-zhuang-tai-yu-shi-jian-pian-xu-partial-orders.html">
            
                    
                    2. Lamport图; happens-before; 网络模型; 状态与事件; 偏序(partial orders)
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4" data-path="2.-lamport-diagramshappensbefore-tong-bu-wang-luo-yu-yi-bu-wang-luo-pian-xu-guan-xi.html">
            
                <a href="2.-lamport-diagramshappensbefore-tong-bu-wang-luo-yu-yi-bu-wang-luo-pian-xu-guan-xi.html">
            
                    
                    2. Lamport Diagrams，Happens-before，同步网络与异步网络，偏序关系
            
                </a>
            

            
        </li>
    

    

    <li class="divider"></li>

    <li>
        <a href="https://www.gitbook.com" target="blank" class="gitbook-link">
            本书使用 GitBook 发布
        </a>
    </li>
</ul>


                </nav>
            
        
    </div>

    <div class="book-body">
        
            <div class="body-inner">
                
                    

<div class="book-header" role="navigation">
    

    <!-- Title -->
    <h1>
        <i class="fa fa-circle-o-notch fa-spin"></i>
        <a href="." >2. Lamport图; happens-before; 网络模型; 状态与事件; 偏序(partial orders)</a>
    </h1>
</div>




                    <div class="page-wrapper" tabindex="-1" role="main">
                        <div class="page-inner">
                            
<div id="book-search-results">
    <div class="search-noresults">
    
                                <section class="normal markdown-section">
                                
                                <h1 id="2-lamport&#x56FE;-happens-before-&#x7F51;&#x7EDC;&#x6A21;&#x578B;-&#x72B6;&#x6001;&#x4E0E;&#x4E8B;&#x4EF6;-&#x504F;&#x5E8F;partial-orders">2. Lamport&#x56FE;; happens-before; &#x7F51;&#x7EDC;&#x6A21;&#x578B;; &#x72B6;&#x6001;&#x4E0E;&#x4E8B;&#x4EF6;; &#x504F;&#x5E8F;(partial orders)</h1>
<p><img src=".gitbook/assets/image%20%285%29.png" alt=""></p>
<ol>
<li>X caused Z</li>
<li>z caused X?</li>
<li>X must caused Z</li>
</ol>
<p>Look at more than one machine state</p>
<p>These machines don&apos;t share memory, the only way to comminicate is to send and recv messages.</p>
<p><img src=".gitbook/assets/image%20%2814%29.png" alt=""></p>
<p>X y Z Internal events, Msg sending and receiving sending events.</p>
<p>Let&apos;s try to come up with a genral defination for when one events happens before another event.</p>
<p>given two events a and B, we say a happened before B, </p>
<ol>
<li>if any of the following is true ,  so A and B occur on the same process line with B after A.</li>
<li>A is a message send event and B is the corresponding receive, </li>
<li>say that if a happens before some other event C and C happens before some other event B because I in the B or the two. makes it a transitive relation we call  this the transitive closure of the of  the relation</li>
</ol>
<p><img src=".gitbook/assets/image%20%2813%29.png" alt=""></p>
<p>so this is the definition of that happens before  relation</p>
<p>this is not actually a an algorithm 14:02 exactly for computing that happens . about ways to compute what is in that  happens before relation for some set of  events so if we see some of it we&apos;ll be able to figure out what events happen before it and we know that the cause of 14:17 that event must be somewhere in that set  of events that happened before it</p>
<p>we have alice and bob and carol and they&apos;re each process and let&apos;s say that alice sends a message to both Bob and Carol and let&apos;s say this message is Bob smells so Bob gets this message right and he can&apos;t really let this stand right so bob has to say something in response so so so bob says you Alice well look what&apos;s happening for Carol here right Carol gets this fu message and she hasn&apos;t seen this original message of Bob smells yet so Carol is super confused right here this is what&apos;s known as a causal anomaly</p>
<p>so generally speaking anomalies are things that make you go huh like Carol is in this example so we&apos;re going to talk about how we can use the concept of happens before to rule out such anomalies so if you look at what went on here um you can see that this Bob smells message kind of took a while to get to Carol um why why did it take so long to get to Carol</p>
<p>sure yeah so there could be any number of reasons right which we talked about last time so recall that we we defined a distributed system as one that experiences unbounded latency so if we&apos;re not careful in designing our systems latency will lead to bugs actually latency is going to lead to problems no matter what since certain problems are literally impossible to avoid in a setting of unbounded latency</p>
<p>but this this brings us to to something else that I want to discuss which is called network models so it would really make life easy if we knew that there was some fixed amount of time that it took for a message to get from Alice to the intended recipient it would sure make it easy to build a system that avoids this kind of bug if we had that kind of guarantee</p>
<p><img src=".gitbook/assets/image%20%2812%29.png" alt=""></p>
<p>we know that there is some fixed amount of time that it takes for a message to get where it gets what what that kind of a network is called a synchronous network so synchronous networks do exist they aren&apos;t the kind that we&apos;re going to be spending most of our time talking about in this course but they&apos;re worth mentioning at least briefly so to be precise a synchronous network is one where there exists on an N some number n such that no message takes longer than n units of time to be delivered.  so synchronous networks do exist a synchronous network for an for a message to be a synchronous, there typically has to be some sort of stable circuit between the sender and the receiver, but we&apos;re not going to be talking much about synchronous networks in this course. so these are this is this is one network model. we&apos;re going to spend most of our time talking about another Network model the asynchronous network model. what&apos;s an asynchronous network um an asynchronous network is just a network where there exists no such n . in this course we&apos;re going to spend most of our time assuming that our networks are asynchronous whether this is a realistic assumption.</p>
<p><img src=".gitbook/assets/image%20%2817%29.png" alt=""></p>
<p>let&apos;s talk about state and events um so we said that a dot on a  port diagram is an event right. but we didn&apos;t talk about state at all right like what if this process has some state before when we were talking about messages between machines m1 and m2 . we said that m1 was asking a question right about about the value of x and we were saying that m2 happened to know or believe that X was five so there isn&apos;t really anything in this picture over here that captures that right that captures this this x equals five. so you know if you wanted to you could kind of just like write it down right here you could say oh this this this process happens to be m1 or m2 rather maybe m1 is over here and then the way that this exchange of messages might look would be like this, and then if all goes well and two is going to respond with the answer. but what I what I would argue to you is that well let&apos;s talk about what state means right, what what is a state that a machine can be in like when you when you study computer architecture for example what do you say that a state is? it&apos;s the the state that a machine is in is something like the contents of the memory and the registers and so on. so that&apos;s the state of one machine but in this world where where events occur on a timeline like this how are we supposed to talk about state. I&apos;m gonna argue that a dot on one of these diagrams is also a state. in the sense that whatever the contents of a computer&apos;s memory are at some point is going to be completely determined by all the events that have happened up until then. so if m2 knows that X is five that means that there had to be some sort of an event somewhere on this process line you know maybe it was an internal event that made X be 5. so a point is an event but it also represents the state and we can always work out what state that we&apos;re in by looking back at the events that have occurred. so one way to represent the state that we&apos;re in is by looking at this sequence of events so we can always work out what state were in so in principle you know if I knew that all the history of events that occurred on M 2, I wouldn&apos;t even have to write this down right because this this fact of X is currently set to 5 would be represented either by an event you know maybe this was the event that said X to 5 or maybe um there was some event that said X to 1 and then there were 4 events that each incremented X by 1 that we&apos;re all internal events but whatever it was there was some some sequence of events that sort of boiled down to being a state. so a point is an event but it&apos;s also a state and we can always work out what state that we&apos;re in by looking back at events is it possible to do the reverse ?if we know right now that X is 5, is it possible to work out what sequence of events led to that with limited resources. probably not. when we do these diagrams we are often actually going to write down little bits of state like this x equals 5 on the diagrams themselves but just think of that as a sort of shorthand for some actual sequence of events so this sort of diagram is actually very very expressive and if we wanted to we could represent everything that ever happened just using this this visual language of process lines and messages and events. so this this piece of state that I&apos;m writing down up here this x equals 5 just think of it as a shorthand for something that I could have expressed using this this this very simple visual language. </p>
<p>let&apos;s just quickly recap the definition of happens before so in chat let&apos;s let&apos;s just define the three pieces of that happens before a relation, somebody blurred it out what are parts 1 2 &amp; 3 of this relation, yeah let&apos;s say so so a and B are actually events, we don&apos;t say a receives a message from B, we talk about processes receiving messages from each other , but we&apos;re going to say a and B are events but you&apos;re on the right track, so we say if a is a send and B is the corresponding receive, then we know that a happened before B okay. </p>
<p><img src=".gitbook/assets/image%20%2811%29.png" alt=""></p>
<p>if you have say m1 and m2 here and you have some events that happen on those processes and let&apos;s say so let&apos;s say you have like event X here and events y&amp;z here and X happens to be ascend and Y is a receive, then we know that X happened before Y because that&apos;s this this second part of the definition we know that Y happened before Z because that&apos;s the first part of the definition and then the the third part of the definition the this this transitive closure piece allows us to sort of glue together.those first two parts of the definition to conclude that X happens before Z. </p>
<p>this is the definition of that of the happens before relation so this I have I&apos;m not being completely precise here actually. so I&apos;ve so I&apos;ve written down three different ways that events can be in the happens before relation so. so strictly speaking it&apos;s it&apos;s actually it&apos;s it&apos;s a it&apos;s a little bit more precise than that it&apos;s it&apos;s we say that it&apos;s the the smallest relation such that this is true. so what do I mean by smallest relation. </p>
<p><img src=".gitbook/assets/image%20%286%29.png" alt=""></p>
<p>so a relation a binary relation like the one that I&apos;m talking about is actually just a set of ordered pairs.if we&apos;re talking about some set of events let&apos;s say so putting some events here let&apos;s just say that we have ABC and D. we have so let&apos;s just try to write down the happens before a relation and by that I just mean the set of pairs of events that are related by this by this happens before a relation. o what are they well okay well we know that a happens before B right because because a is a send and be used to receive so we can we can put that pair. and then we know that B happens before C right because b is before C on the same process line and then we know that a happens before C because of transitivity and we know the D happens before C right because DS ascends and Caesar receive. is that it or did I miss any ah so somebody asks in chat should ad be in there did a happen before D do we know that? so we don&apos;t know that um there&apos;s there&apos;s maybe it did right but we don&apos;t know for sure that it did. it looks like D appears a little bit lower than a in this picture so it might indeed look as though D happened before a but our definition of happens before does not does not tell us anything about whether a happened before D. o it this pair is actually not part of the that happens before relation for this so for this particular set of events. so this gets back to two to what I was saying about smallest relations so so we said that there were three conditions under under which a pair of events could could it be included in that happens before relation. so the the three possibilities just to represent them visually or either the events are on the same process line or one of the events is ascend in the other event is the corresponding receive or it&apos;s the transitive closure of the of of those things so those are those are the possibilities. but we say that the happens before relation is the smallest relation and so if you think of a relation is just being a set of pairs I&apos;m saying the set the smallest set such that all of these things are included in it. so if I didn&apos;t have that condition that it had to be the smallest relation such that all these things are included in it and I could say oh well okay I&apos;ve got all these things covered but then I&apos;m also going to throw all kinds of other garbage and might happens before relation as well and it&apos;ll still it&apos;ll still check all the checkboxes it&apos;ll just also have other stuff in it as well. so we actually don&apos;t we don&apos;t want to be that loose in defining what happens before means because then because then stuff will be included in that happens before a relation that we don&apos;t want so that&apos;s that&apos;s why if we&apos;re being pedantic about it we have to say we have to say that the happens before relation is the smallest relation such that these three conditions are true. </p>
<p><img src=".gitbook/assets/image%20%2815%29.png" alt=""></p>
<p>so let&apos;s do a few examples and think about what happens before, so let&apos;s look at this and let&apos;s just try to talk about what happened before. if I I&apos;m gonna pick out two events and and you you tell me if they&apos;re related by the happens before relation. </p>
<p>how about a P and s are those related by happens before sure </p>
<p>okay okay what about X and z</p>
<p>how about P and z yeah those are as well of by transitivity right because we can get from P to s to Y 2 T to Z here</p>
<p>how about Q and R those are not related by that happens before a relation and so by that I mean it&apos;s not true that Q happened before our but it&apos;s also not true that our happen to be for Q.o we can write that this way we can write the line with a slash through it</p>
<p><img src=".gitbook/assets/image%20%2816%29.png" alt=""></p>
<p>when this is the case for two events we say that they&apos;re concurrent</p>
<p>another way that&apos;s written is to put a double line between them so sometimes people write it like this</p>
<p><img src=".gitbook/assets/image%20%289%29.png" alt=""></p>
<p>another word we use to describe it when they&apos;re concurrent is we say that they&apos;re independent</p>
<p><img src=".gitbook/assets/image%20%288%29.png" alt=""></p>
<p>I want to talk a little bit about partial orders</p>
<p>so this relation that we&apos;ve been talking about this happens before relation is a is a particular kind of relation it&apos;s called a partial order it&apos;s actually a special kind of partial order, but we&apos;ll get more into that later um so can somebody who&apos;s maybe maybe taken a math class that studied this I tell me what the definition of a partial order is ?partial order is actually two things glued together, first it&apos;s a set let&apos;s call it s and then that set comes together with something, a binary relation usually but not always written like this so something that looks like , less than or equal, that lets you compare things from the set s and it has to have the following properties.</p>
<p>reflexivity, what does that mean, it means that for all a that are in this set s is less than or equal to a, </p>
<p>anti symmetry, t says that if we&apos;re talking about a and B, say that if a is less than or equal to B &amp; B is less than or equal to a, then a equals B.those are the properties that have to be true of a partial order.</p>
<p>transitivity, for all a B and C in the set s this is a I&apos;m not sure if you can read my writing or not but this this symbol right here is is this symbol right here is the symbol for in so I&apos;m saying that a B and C are in S or in our members of s so transitivity says that if a is related to B and B is related to C then a is related to C.</p>
<p>I just claimed that that happens before relation is a partial order but that happens before a relation is actually a little bit weird</p>
<p>because if we try to think about the happens before relation which is a relation on events and we try to think about how that fits together with this definition that I just wrote down it&apos;s probably going to seem a little strange, because a partial order is supposed to be reflexive, so a classic example of the partial of a partial order is just this plain old less than or equal to relationship on let&apos;s say natural numbers, this is this is true of natural numbers. but if we&apos;re talking about events in a distributed system if we&apos;re talking about the happens before it relation on events it doesn&apos;t make any sense to say that an event a happens before a. so the happens before relation is a weird partial order that does not actually respect these rules. we say that the HAP before relation is an irreflexive.it&apos;s a weird one right it&apos;s not the partial order it&apos;s it&apos;s not it&apos;s not a partial order according to this definition.well so don&apos;t get confused right that happens before relation is not quite a partial order according to this definition instead we say that it&apos;s an it&apos;s an irreflexive partial order. but if we look at these other these other other properties certainly transitivity is going to be true of that happens before relation. what about anti symmetry well so if you have if you if you have two events, </p>

                                
                                </section>
                            
    </div>
    <div class="search-results">
        <div class="has-results">
            
            <h1 class="search-results-title"><span class='search-results-count'></span> results matching "<span class='search-query'></span>"</h1>
            <ul class="search-results-list"></ul>
            
        </div>
        <div class="no-results">
            
            <h1 class="search-results-title">No results matching "<span class='search-query'></span>"</h1>
            
        </div>
    </div>
</div>

                        </div>
                    </div>
                
            </div>

            
                
                <a href="distributed-systems-what-and-why-time-and-clocks.html" class="navigation navigation-prev " aria-label="Previous page: 1. 什么是和为什么分布式系统？时间和时钟。">
                    <i class="fa fa-angle-left"></i>
                </a>
                
                
                <a href="2.-lamport-diagramshappensbefore-tong-bu-wang-luo-yu-yi-bu-wang-luo-pian-xu-guan-xi.html" class="navigation navigation-next " aria-label="Next page: 2. Lamport Diagrams，Happens-before，同步网络与异步网络，偏序关系">
                    <i class="fa fa-angle-right"></i>
                </a>
                
            
        
    </div>

    <script>
        var gitbook = gitbook || [];
        gitbook.push(function() {
            gitbook.page.hasChanged({"page":{"title":"2. Lamport图; happens-before; 网络模型; 状态与事件; 偏序(partial orders)","level":"1.3","depth":1,"next":{"title":"2. Lamport Diagrams，Happens-before，同步网络与异步网络，偏序关系","level":"1.4","depth":1,"path":"2.-lamport-diagramshappensbefore-tong-bu-wang-luo-yu-yi-bu-wang-luo-pian-xu-guan-xi.md","ref":"2.-lamport-diagramshappensbefore-tong-bu-wang-luo-yu-yi-bu-wang-luo-pian-xu-guan-xi.md","articles":[]},"previous":{"title":"1. 什么是和为什么分布式系统？时间和时钟。","level":"1.2","depth":1,"path":"distributed-systems-what-and-why-time-and-clocks.md","ref":"distributed-systems-what-and-why-time-and-clocks.md","articles":[]},"dir":"ltr"},"config":{"plugins":["disqus","ga"],"root":".","styles":{"website":"styles/website.css","pdf":"styles/pdf.css","epub":"styles/epub.css","mobi":"styles/mobi.css","ebook":"styles/ebook.css","print":"styles/print.css"},"pluginsConfig":{"disqus":{"useIdentifier":false,"shortName":"distributed-system"},"ga":{"configuration":"auto","token":"UA-131378726-6"},"highlight":{},"search":{},"lunr":{"maxIndexSize":1000000,"ignoreSpecialCharacters":false},"sharing":{"facebook":true,"twitter":true,"google":false,"weibo":false,"instapaper":false,"vk":false,"all":["facebook","google","twitter","weibo","instapaper"]},"fontsettings":{"theme":"white","family":"sans","size":2},"theme-default":{"styles":{"website":"styles/website.css","pdf":"styles/pdf.css","epub":"styles/epub.css","mobi":"styles/mobi.css","ebook":"styles/ebook.css","print":"styles/print.css"},"showLevel":false}},"theme":"default","author":"Huadong Hu","pdf":{"pageNumbers":true,"fontSize":12,"fontFamily":"Arial","paperSize":"a4","chapterMark":"pagebreak","pageBreaksBefore":"/","margin":{"right":62,"left":62,"top":56,"bottom":56}},"structure":{"langs":"LANGS.md","readme":"README.md","glossary":"GLOSSARY.md","summary":"SUMMARY.md"},"variables":{},"title":"分布式系统","language":"zh-hans","gitbook":"*","description":"分布式系统概述"},"file":{"path":"2.-lamport-tu-happensbefore-wang-luo-mo-xing-zhuang-tai-yu-shi-jian-pian-xu-partial-orders.md","mtime":"2020-05-22T02:04:42.091Z","type":"markdown"},"gitbook":{"version":"3.2.3","time":"2020-05-22T02:05:08.012Z"},"basePath":".","book":{"language":""}});
        });
    </script>
</div>

        
    <script src="gitbook/gitbook.js"></script>
    <script src="gitbook/theme.js"></script>
    
        
        <script src="https://cdnjs.cloudflare.com/ajax/libs/URI.js/1.16.1/URI.min.js"></script>
        
    
        
        <script src="gitbook/gitbook-plugin-disqus/plugin.js"></script>
        
    
        
        <script src="gitbook/gitbook-plugin-ga/plugin.js"></script>
        
    
        
        <script src="gitbook/gitbook-plugin-search/search-engine.js"></script>
        
    
        
        <script src="gitbook/gitbook-plugin-search/search.js"></script>
        
    
        
        <script src="gitbook/gitbook-plugin-lunr/lunr.min.js"></script>
        
    
        
        <script src="gitbook/gitbook-plugin-lunr/search-lunr.js"></script>
        
    
        
        <script src="gitbook/gitbook-plugin-sharing/buttons.js"></script>
        
    
        
        <script src="gitbook/gitbook-plugin-fontsettings/fontsettings.js"></script>
        
    

    </body>
</html>

