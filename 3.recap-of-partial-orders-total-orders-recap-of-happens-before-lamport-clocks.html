
<!DOCTYPE HTML>
<html lang="zh-hans" >
    <head>
        <meta charset="UTF-8">
        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <title>3. Lamport时钟(Lamport clocks) · 分布式系统</title>
        <meta http-equiv="X-UA-Compatible" content="IE=edge" />
        <meta name="description" content="">
        <meta name="generator" content="GitBook 3.2.3">
        <meta name="author" content="Huadong Hu">
        
        
    
    <link rel="stylesheet" href="gitbook/style.css">

    
            
                
                <link rel="stylesheet" href="gitbook/gitbook-plugin-disqus/plugin.css">
                
            
                
                <link rel="stylesheet" href="gitbook/gitbook-plugin-highlight/website.css">
                
            
                
                <link rel="stylesheet" href="gitbook/gitbook-plugin-search/search.css">
                
            
                
                <link rel="stylesheet" href="gitbook/gitbook-plugin-fontsettings/website.css">
                
            
        

    

    
        
    
        
    
        
    
        
    
        
    
        
    

        
    
    
    <meta name="HandheldFriendly" content="true"/>
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <link rel="apple-touch-icon-precomposed" sizes="152x152" href="gitbook/images/apple-touch-icon-precomposed-152.png">
    <link rel="shortcut icon" href="gitbook/images/favicon.ico" type="image/x-icon">

    
    
    <link rel="prev" href="2.-lamport-diagramshappensbefore-tong-bu-wang-luo-yu-yi-bu-wang-luo-pian-xu-guan-xi.html" />
    

    </head>
    <body>
        
<div class="book">
    <div class="book-summary">
        
            
<div id="book-search-input" role="search">
    <input type="text" placeholder="输入并搜索" />
</div>

            
                <nav role="navigation">
                


<ul class="summary">
    
    

    

    
        
        
    
        <li class="chapter " data-level="1.1" data-path="./">
            
                <a href="./">
            
                    
                    📚分布式系统(Distributed Systems)
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2" data-path="distributed-systems-what-and-why-time-and-clocks.html">
            
                <a href="distributed-systems-what-and-why-time-and-clocks.html">
            
                    
                    1. 什么是和为什么分布式系统？时间和时钟。
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3" data-path="2.-lamport-diagramshappensbefore-tong-bu-wang-luo-yu-yi-bu-wang-luo-pian-xu-guan-xi.html">
            
                <a href="2.-lamport-diagramshappensbefore-tong-bu-wang-luo-yu-yi-bu-wang-luo-pian-xu-guan-xi.html">
            
                    
                    2. Lamport Diagrams，Happens-before，同步网络与异步网络，偏序关系
            
                </a>
            

            
        </li>
    
        <li class="chapter active" data-level="1.4" data-path="3.recap-of-partial-orders-total-orders-recap-of-happens-before-lamport-clocks.html">
            
                <a href="3.recap-of-partial-orders-total-orders-recap-of-happens-before-lamport-clocks.html">
            
                    
                    3. Lamport时钟(Lamport clocks)
            
                </a>
            

            
        </li>
    

    

    <li class="divider"></li>

    <li>
        <a href="https://www.gitbook.com" target="blank" class="gitbook-link">
            本书使用 GitBook 发布
        </a>
    </li>
</ul>


                </nav>
            
        
    </div>

    <div class="book-body">
        
            <div class="body-inner">
                
                    

<div class="book-header" role="navigation">
    

    <!-- Title -->
    <h1>
        <i class="fa fa-circle-o-notch fa-spin"></i>
        <a href="." >3. Lamport时钟(Lamport clocks)</a>
    </h1>
</div>




                    <div class="page-wrapper" tabindex="-1" role="main">
                        <div class="page-inner">
                            
<div id="book-search-results">
    <div class="search-noresults">
    
                                <section class="normal markdown-section">
                                
                                <h1 id="3-lamport&#x65F6;&#x949F;lamport-clocks">3. Lamport&#x65F6;&#x949F;(Lamport clocks)</h1>
<p><img src=".gitbook/assets/image%20%2833%29.png" alt=""></p>
<p>physical clocks so what it what did we 18:41 say the alternative to 18:43 using physical clocks was logical clocks</p>
<p>yeah so this is this is an entirely different notion of clock logical clocks</p>
<p>don&apos;t tell us anything about the time of day and they don&apos;t tell us anything about time elapsed </p>
<p>instead logical clocks only tell us about the ordering of events</p>
<p>simplest kind of logical clock that I am aware of is called a Lamport clock</p>
<p>nna Lambert clock is just a way of assigning numbers to events</p>
<p>if you have an event let&apos;s say event a then it&apos;s Lamport clock which we write LC of a</p>
<p>it might be three for instance so what are these Lamport clocks mean like what is that number three tell you</p>
<p>here&apos;s a rule we know that if a happens before B then the Lamport clock of a is less than the Lamport clock of B</p>
<p>so we say that Lamport clocks are consistent with causality that means that if there&apos;s a causal relationship between a and B or a potentially causal relationship between a and B that is if a happens before B, then we know that the Lamport clock of a is going to be less than the Lamport clock of B</p>
<p>we&apos;re gonna write down the rules for assigning Lamport clocks to events</p>
<p>here&apos;s some events</p>
<p><img src=".gitbook/assets/image%20%2828%29.png" alt=""></p>
<p>all right so here&apos;s the algorithm for assigning Lamport clocks to events</p>
<ul>
<li>first of all every process has a counter that&apos;s initialized to zero an integer counter or natural number counter</li>
<li>on every event a process will increment its counter by one</li>
<li>when sending a message a process includes its current counter along with the message</li>
<li>step 4 is what you do when receiving a message, what do you think happens here what do you think you do when you receive a message? what you&apos;re gonna do is set your counter to the max of( your local counter and the message counter plus one)</li>
</ul>
<p>if you&apos;ve seen this before and it didn&apos;t have the plus one then that&apos;s why that might be why but we&apos;re going to be treating message receives as events for now later in the course we might look at a scenario where message receives don&apos;t count as it events</p>
<p>we have a way of assigning numbers to events now so let&apos;s try it</p>
<p><img src=".gitbook/assets/image%20%2827%29.png" alt=""></p>
<p><img src=".gitbook/assets/image%20%2832%29.png" alt=""></p>
<p>you&apos;ll see that this this condition that we wrote down before is in fact true so if a happens before B then the lamp or a clock of a is indeed going to be less than the Lamport clock of B this was a pretty simple one</p>
<p>we know that if a happens before B then Lamport clock of whoops that should just be less than L C of a is less than L C of B</p>
<p>so if LC of A is less than L C of B do we know that it happened before B</p>
<p>the answer is no</p>
<p>let&apos;s look at an example of that</p>
<p><img src=".gitbook/assets/image%20%2829%29.png" alt=""></p>
<p><img src=".gitbook/assets/image%20%2823%29.png" alt=""></p>
<p>if we look at a and B do we know for sure that a happened before B? NO!</p>
<p>by our definition of happens before, on the same process line right and that doesn&apos;t happen here because they&apos;re in different process lines, or one has to be assigned and the other has to be a corresponding receive and that&apos;s not the case here either or they have to be ena happens before relationship by transitivity but that&apos;s not the case here either. there is no connection between a and B in terms of the happens before relation.we have a situation here where the Lamport clock of a is less than Lamport clock of b but it certainly does not mean that a had to happen before B</p>
<p>o the answer to this question if the Lamport clock of a is less than Lamport clock of B do we know a happened before B and the answer to that is a resounding no</p>
<p><img src=".gitbook/assets/image%20%2820%29.png" alt=""></p>
<p>if you want to know if this event know happened before this event if you can reach the second event from the first event then you know that it happened that that the first event happened before the second event. so in other words like if I wanted to know if this event right here the first event at the top of p2 if I wanted to know whether it happened before this one. I just asked okay can I draw a line from there to there and it turns out that I can.</p>
<p>we can say that causality is graph reach ability in space-time, in this picture you can&apos;t reach B from a so you can&apos;t say that a happened before B even though basil import clock is bigger than A&apos;s.</p>
<p><img src=".gitbook/assets/image%20%2831%29.png" alt=""></p>
<p>this is the consistent with causality direction but it&apos;s not the case that if the Lamport clock of a is less than the Lamport clock of B then a happens before B. so we say Lamport clocks do not characterize causality</p>
<p>it&apos;s an example that&apos;s taken from a paper by Schwartz and Mattern which i think is from 1994 and the paper is called detecting causal relationships in distributed systems in search of the Holy Grail so Mattern was one of the people who developed another kind of logical clock that does characterize causality unlike Lamport clocks and that&apos;s called a vector clock and we&apos;ll talk about that soon.</p>
<p>vector clocks were invented in the 80s some time and then this paper didn&apos;t come out until 1994 but I think this paper does a really really nice job of explaining the need for this notion of vector clock</p>
<p>we&apos;re still talking about Lamport clocks not vector clocks so Lamport clocks well okay so we say we said limpert clocks do not characterize causality, Lamport clocks do not characterize causality um well okay so what are they good for why would you ever want to use that.</p>
<p>I want to give a kind of a mathematical argument for for why Lamport clocks are still useful even though they don&apos;t characterize causality</p>
<p><img src=".gitbook/assets/image%20%2825%29.png" alt=""></p>
<p>we know that if a happens before B then the Lamport clock of a is less than the limpert clock of B</p>
<p>contra positives say that if P implies Q then not Q implies not P</p>
<p>if it&apos;s not the case that the Lamport clock of a is less than the Lamport clock of B, then it&apos;s not the case that a happens before B.that&apos;s the contrapositive of this thing.</p>
<p><img src=".gitbook/assets/image%20%2818%29.png" alt=""></p>
<p>that&apos;s what Lamport clocks can be used for they can rule out things as not having caused other things and that actually turns out to be really valuable. it lets us debug.</p>
<p>Quiz</p>
<p><img src=".gitbook/assets/image%20%2822%29.png" alt=""></p>
<p>next time we&apos;re going to talk about vector clocks</p>

                                
                                </section>
                            
    </div>
    <div class="search-results">
        <div class="has-results">
            
            <h1 class="search-results-title"><span class='search-results-count'></span> results matching "<span class='search-query'></span>"</h1>
            <ul class="search-results-list"></ul>
            
        </div>
        <div class="no-results">
            
            <h1 class="search-results-title">No results matching "<span class='search-query'></span>"</h1>
            
        </div>
    </div>
</div>

                        </div>
                    </div>
                
            </div>

            
                
                <a href="2.-lamport-diagramshappensbefore-tong-bu-wang-luo-yu-yi-bu-wang-luo-pian-xu-guan-xi.html" class="navigation navigation-prev navigation-unique" aria-label="Previous page: 2. Lamport Diagrams，Happens-before，同步网络与异步网络，偏序关系">
                    <i class="fa fa-angle-left"></i>
                </a>
                
                
            
        
    </div>

    <script>
        var gitbook = gitbook || [];
        gitbook.push(function() {
            gitbook.page.hasChanged({"page":{"title":"3. Lamport时钟(Lamport clocks)","level":"1.4","depth":1,"previous":{"title":"2. Lamport Diagrams，Happens-before，同步网络与异步网络，偏序关系","level":"1.3","depth":1,"path":"2.-lamport-diagramshappensbefore-tong-bu-wang-luo-yu-yi-bu-wang-luo-pian-xu-guan-xi.md","ref":"2.-lamport-diagramshappensbefore-tong-bu-wang-luo-yu-yi-bu-wang-luo-pian-xu-guan-xi.md","articles":[]},"dir":"ltr"},"config":{"plugins":["disqus","ga"],"root":".","styles":{"website":"styles/website.css","pdf":"styles/pdf.css","epub":"styles/epub.css","mobi":"styles/mobi.css","ebook":"styles/ebook.css","print":"styles/print.css"},"pluginsConfig":{"disqus":{"useIdentifier":false,"shortName":"distributed-system"},"ga":{"configuration":"auto","token":"UA-131378726-6"},"highlight":{},"search":{},"lunr":{"maxIndexSize":1000000,"ignoreSpecialCharacters":false},"sharing":{"facebook":true,"twitter":true,"google":false,"weibo":false,"instapaper":false,"vk":false,"all":["facebook","google","twitter","weibo","instapaper"]},"fontsettings":{"theme":"white","family":"sans","size":2},"theme-default":{"styles":{"website":"styles/website.css","pdf":"styles/pdf.css","epub":"styles/epub.css","mobi":"styles/mobi.css","ebook":"styles/ebook.css","print":"styles/print.css"},"showLevel":false}},"theme":"default","author":"Huadong Hu","pdf":{"pageNumbers":true,"fontSize":12,"fontFamily":"Arial","paperSize":"a4","chapterMark":"pagebreak","pageBreaksBefore":"/","margin":{"right":62,"left":62,"top":56,"bottom":56}},"structure":{"langs":"LANGS.md","readme":"README.md","glossary":"GLOSSARY.md","summary":"SUMMARY.md"},"variables":{},"title":"分布式系统","language":"zh-hans","gitbook":"*","description":"分布式系统概述"},"file":{"path":"3.recap-of-partial-orders-total-orders-recap-of-happens-before-lamport-clocks.md","mtime":"2020-05-23T03:26:30.233Z","type":"markdown"},"gitbook":{"version":"3.2.3","time":"2020-05-23T03:26:38.770Z"},"basePath":".","book":{"language":""}});
        });
    </script>
</div>

        
    <script src="gitbook/gitbook.js"></script>
    <script src="gitbook/theme.js"></script>
    
        
        <script src="https://cdnjs.cloudflare.com/ajax/libs/URI.js/1.16.1/URI.min.js"></script>
        
    
        
        <script src="gitbook/gitbook-plugin-disqus/plugin.js"></script>
        
    
        
        <script src="gitbook/gitbook-plugin-ga/plugin.js"></script>
        
    
        
        <script src="gitbook/gitbook-plugin-search/search-engine.js"></script>
        
    
        
        <script src="gitbook/gitbook-plugin-search/search.js"></script>
        
    
        
        <script src="gitbook/gitbook-plugin-lunr/lunr.min.js"></script>
        
    
        
        <script src="gitbook/gitbook-plugin-lunr/search-lunr.js"></script>
        
    
        
        <script src="gitbook/gitbook-plugin-sharing/buttons.js"></script>
        
    
        
        <script src="gitbook/gitbook-plugin-fontsettings/fontsettings.js"></script>
        
    

    </body>
</html>

